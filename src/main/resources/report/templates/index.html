<!DOCTYPE html>
<html>
<head>
    <title>ME2E Test Results</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.0/css/all.css">
    <link rel="stylesheet" href="tree-table/jquery.treetable.css">
    <link rel="stylesheet" href="css/report-style.css">
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="tree-table/jquery.treetable.js"></script>
    <style>
        .metrics-box {
            display: flex;
            align-items: center;

            & i {
                font-size: 32px;
            }
        }

        .metrics {
            display: grid;
            text-align: center;
            width: 100%;
            left: 32px;
            transform: translateX(-48px);
            position: relative;

            & .title {
                font-size: 32px;
                font-weight: bold;
                margin-bottom: 4px;
            }

            & .label {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
<h1>Test Summary</h1>
<div class="grid-container">
    <div class="card metrics-box">
        <i class="fas fa-clipboard-list primary"></i>
        <div class="metrics">
            <span class="title" th:text="${numberOfTests}"></span>
            <span class="label">Tests</span>
        </div>
    </div>
    <div class="card metrics-box">
        <i class="fas fa-circle-xmark" th:classappend="${numberOfFailures > 0 ? 'failure' : 'success'}"></i>
        <div class="metrics">
            <span class="title" th:classappend="${numberOfFailures > 0 ? 'failure' : 'success'}" th:text="${numberOfFailures}"></span>
            <span class="label">Failures</span>
        </div>
    </div>
    <div class="card metrics-box">
        <i class="fas fa-ban skipped"></i>
        <div class="metrics">
            <span class="title skipped" th:text="${numberOfSkipped + numberOfAborted}"></span>
            <span class="label">Ignored</span>
        </div>
    </div>
    <div class="card metrics-box">
        <i class="fas fa-stopwatch primary"></i>
        <div class="metrics">
            <span class="title" th:text="${duration != null ? duration + 's' : '-'}"></span>
            <span class="label">Duration</span>
        </div>
    </div>
    <div class="card metrics-box">
        <i class="fas fa-bullseye"
           th:classappend="${numberOfTests == numberOfSkipped ? 'skipped' : (numberOfFailures > 0 ? 'failure' : (numberOfAborted > 0 ? 'aborted' : 'success'))}"
        ></i>
        <div class="metrics">
            <span class="title"
                  th:classappend="${numberOfTests == numberOfSkipped ? 'skipped' : (numberOfFailures > 0 ? 'failure' : (numberOfAborted > 0 ? 'aborted' : 'success'))}"
                  th:text="${successRate != null ? successRate + ' %' : '-'}"
            ></span>
            <span class="label">Success Rate</span>
        </div>
    </div>
</div>

<h2>Executed Tests</h2>

<div class="card" style="padding: 24px">
    <table class="tree-table test-overview-table" id="test-overview">
        <thead>
        <tr>
            <th class="align-left">Test</th>
            <th>Tests</th>
            <th>Failures</th>
            <th>Ignored</th>
            <th>Duration</th>
            <th>Success Rate</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="test : ${allTests}" th:data-tt-id="${test.testId}" th:data-tt-parent-id="${test.parentId}">
            <td class="align-left">
                <a th:classappend="${test.status.name == 'SKIPPED' ? 'skipped' : (test.numberOfFailures > 0 ? 'failure' : (test.numberOfAborted > 0 ? 'aborted' : 'success'))}"
                   th:href="${'sources/' + test.source + '.html' + (test.parentId != null ? '#' + test.testId : '')}"
                >
                    <span th:text="${test.displayName}"></span>
                </a>
            </td>
            <td th:text="${test.numberOfTests}"></td>
            <td th:text="${test.numberOfFailures}"></td>
            <td th:text="${test.numberOfSkipped + test.numberOfAborted}"></td>
            <td th:text="${test.status.name != 'SKIPPED' ? test.duration + 's' : '-'}"></td>
            <td th:classappend="${test.status.name == 'SKIPPED' ? 'skipped' : (test.numberOfFailures > 0 ? 'failure' : (test.numberOfAborted > 0 ? 'aborted' : 'success'))}"
                th:text="${(test.successRate != null && test.status.name != 'ABORTED') ? test.successRate + ' %' : '-'}"
            ></td>
        </tr>
        </tbody>
    </table>
</div>

<div id="footer">
    <span>Generated by <a href="https://gitlab.informatik.uni-bremen.de/master-thesis1/me2e">ME2E</a> at [[${generationTimestamp}]]</span>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $("#test-overview").treetable({
            expandable: true,
            initialState: "expanded",
            indent: 20,
        });
    });
</script>
</body>
</html>
